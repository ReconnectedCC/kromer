{"schemas":"DEFINE FUNCTION OVERWRITE fn::create_wallet($initial_balance: option<decimal>) {\nLET $address = rand::string(10).lowercase();\nLET $password = rand::string(16);\nLET $hash = crypto::argon2::generate($password);\nLET $wallet = (CREATE wallet CONTENT { address: $address, balance: $initial_balance OR 0f, hash: $hash });\nRETURN { address: $address, password: $password, wallet: $wallet.first() };\n} PERMISSIONS FULL;\n\nDEFINE FUNCTION OVERWRITE fn::create_wallet_ext($address: string, $hash: string, $initial_bal: decimal) {\n    LET $wallet = (CREATE wallet CONTENT { address: $address, balance: $initial_bal OR 0f, hash: $hash });\n    RETURN $wallet; \n} PERMISSIONS FULL;\n\nDEFINE FUNCTION OVERWRITE fn::transfer_balance($from: record<wallet>, $to: record<wallet> | record<name>, $amount: decimal) {\nUPDATE $from SET balance -= $amount;\nUPDATE $from SET total_out += $amount;\nRETURN IF record::tb($to) == 'name' {\nLET $owner = $to.owner;\nUPDATE $owner SET balance += $amount;\nUPDATE $owner SET total_in += $amount;\n} ELSE {\nUPDATE $to SET balance += $amount;\nUPDATE $to SET total_in += $amount;\n};\n} PERMISSIONS FULL;\nDEFINE TABLE OVERWRITE name TYPE NORMAL SCHEMALESS PERMISSIONS NONE;\n\nDEFINE FIELD OVERWRITE last_transfered ON name TYPE option<datetime> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE last_updated ON name TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE name ON name TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE original_owner ON name TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE owner ON name TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE registered ON name TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE updated ON name TYPE option<datetime> DEFAULT time::now() PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE transfered ON name TYPE option<datetime> DEFAULT time::now() PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE a ON name TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE unpaid ON name TYPE int;\n\n\nDEFINE INDEX OVERWRITE nameIndex ON TABLE name COLUMNS name UNIQUE;\nDEFINE TABLE OVERWRITE player TYPE ANY SCHEMALESS PERMISSIONS NONE;\n\nDEFINE FIELD OVERWRITE joined_at ON player TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE name ON player TYPE string PERMISSIONS FULL;\nDEFINE TABLE OVERWRITE script_migration SCHEMAFULL\n    PERMISSIONS\n        FOR select FULL\n        FOR create, update, delete NONE;\n\nDEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\nDEFINE FIELD OVERWRITE executed_at ON script_migration TYPE datetime VALUE time::now() READONLY;\nDEFINE TABLE OVERWRITE transaction TYPE NORMAL SCHEMAFULL PERMISSIONS NONE;\n\nDEFINE FIELD OVERWRITE amount ON transaction TYPE decimal PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE from ON transaction TYPE record<wallet> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE metadata ON transaction TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE timestamp ON transaction TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE to ON transaction TYPE record<wallet> | record<name> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE transaction_type ON transaction TYPE 'unknown' | 'mined' | 'name_purchase' | 'transfer' PERMISSIONS FULL;\n\n\n\nDEFINE TABLE OVERWRITE wallet TYPE NORMAL SCHEMAFULL PERMISSIONS NONE;\n\nDEFINE FIELD OVERWRITE address ON wallet TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE balance ON wallet TYPE decimal DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE created_at ON wallet TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE hash ON wallet TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE is_shared ON wallet TYPE bool DEFAULT false PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE total_in ON wallet TYPE decimal DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE total_out ON wallet TYPE decimal DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE locked ON wallet TYPE bool DEFAULT false PERMISSIONS FULL;\n\nDEFINE TABLE OVERWRITE owns TYPE RELATION IN player OUT wallet SCHEMAFULL PERMISSIONS NONE;\n\nDEFINE INDEX OVERWRITE addressIndex ON TABLE wallet COLUMNS address UNIQUE;","events":"DEFINE EVENT OVERWRITE transfer_balance ON transaction WHEN $event = 'CREATE' THEN {\nLET $from = $after.from;\nLET $to = $after.to;\nLET $amount = $after.amount;\nRETURN fn::transfer_balance($from, $to, $amount);\n};"}