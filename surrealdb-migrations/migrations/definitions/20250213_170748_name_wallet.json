{"schemas":"--- original\n+++ modified\n@@ -1,74 +1,72 @@\n-DEFINE FUNCTION OVERWRITE fn::create_wallet($initial_balance: option<decimal>) {\n-LET $address = rand::string(10).lowercase();\n-LET $password = rand::string(16);\n-LET $hash = crypto::argon2::generate($password);\n-LET $wallet = (CREATE wallet CONTENT { address: $address, balance: $initial_balance OR 0f, hash: $hash });\n-RETURN { address: $address, password: $password, wallet: $wallet.first() };\n+DEFINE FUNCTION OVERWRITE fn::create_wallet($initial_balance: option<decimal>) {\r\n+LET $address = rand::string(10).lowercase();\r\n+LET $password = rand::string(16);\r\n+LET $hash = crypto::argon2::generate($password);\r\n+LET $wallet = (CREATE wallet CONTENT { address: $address, balance: $initial_balance OR 0f, hash: $hash });\r\n+RETURN { address: $address, password: $password, wallet: $wallet.first() };\r\n+} PERMISSIONS FULL;\r\n+\r\n+DEFINE FUNCTION OVERWRITE fn::create_wallet_ext($address: string, $hash: string, $initial_bal: decimal) {\r\n+    LET $wallet = (CREATE wallet CONTENT { address: $address, balance: $initial_bal OR 0f, hash: $hash });\r\n+    RETURN $wallet; \r\n+} PERMISSIONS FULL;\r\n+\r\n+DEFINE FUNCTION OVERWRITE fn::transfer_balance($from: string, $to: string | record<name>, $amount: decimal) {\r\n+LET $from_wallet = (SELECT * FROM wallet WHERE address == $from).first();\r\n+LET $to_wallet = (SELECT * FROM wallet WHERE address == $to).first();\r\n+UPDATE $from_wallet SET balance -= $amount;\r\n+UPDATE $from_wallet SET total_out += $amount;\r\n+UPDATE $to_wallet SET balance += $amount;\r\n+UPDATE $to_wallet SET total_in += $amount;\r\n } PERMISSIONS FULL;\n-\n-DEFINE FUNCTION OVERWRITE fn::create_wallet_ext($address: string, $hash: string, $initial_bal: decimal) {\n-    LET $wallet = (CREATE wallet CONTENT { address: $address, balance: $initial_bal OR 0f, hash: $hash });\n-    RETURN $wallet; \n-} PERMISSIONS FULL;\n-\n-DEFINE FUNCTION OVERWRITE fn::transfer_balance($from: string, $to: string | record<name>, $amount: decimal) {\n-LET $from_wallet = (SELECT * FROM wallet WHERE address == $from).first();\n-LET $to_wallet = (SELECT * FROM wallet WHERE address == $to).first();\n-UPDATE $from_wallet SET balance -= $amount;\n-UPDATE $from_wallet SET total_out += $amount;\n-UPDATE $to_wallet SET balance += $amount;\n-UPDATE $to_wallet SET total_in += $amount;\n-} PERMISSIONS FULL;\n-DEFINE TABLE OVERWRITE name TYPE NORMAL SCHEMALESS PERMISSIONS NONE;\n-\n-DEFINE FIELD OVERWRITE last_transfered ON name TYPE option<datetime> PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE last_updated ON name TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE name ON name TYPE string PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE original_owner ON name TYPE option<string> PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE owner ON name TYPE string PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE registered ON name TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE updated ON name TYPE option<datetime> DEFAULT time::now() PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE transfered ON name TYPE option<datetime> DEFAULT time::now() PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE a ON name TYPE option<string> PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE unpaid ON name TYPE int;\n-\n-\n+DEFINE TABLE OVERWRITE name TYPE NORMAL SCHEMALESS PERMISSIONS NONE;\r\n+\r\n+DEFINE FIELD OVERWRITE last_transfered ON name TYPE option<datetime> PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE last_updated ON name TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE name ON name TYPE string PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE original_owner ON name TYPE option<string> PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE owner ON name TYPE string PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE registered ON name TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE updated ON name TYPE option<datetime> DEFAULT time::now() PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE transfered ON name TYPE option<datetime> DEFAULT time::now() PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE a ON name TYPE option<string> PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE unpaid ON name TYPE int;\r\n+\r\n+\r\n DEFINE INDEX OVERWRITE nameIndex ON TABLE name COLUMNS name UNIQUE;\n-DEFINE TABLE OVERWRITE player TYPE ANY SCHEMALESS PERMISSIONS NONE;\n-\n-DEFINE FIELD OVERWRITE joined_at ON player TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\n+DEFINE TABLE OVERWRITE player TYPE ANY SCHEMALESS PERMISSIONS NONE;\r\n+\r\n+DEFINE FIELD OVERWRITE joined_at ON player TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\r\n DEFINE FIELD OVERWRITE name ON player TYPE string PERMISSIONS FULL;\n-DEFINE TABLE OVERWRITE script_migration SCHEMAFULL\n-    PERMISSIONS\n-        FOR select FULL\n-        FOR create, update, delete NONE;\n-\n-DEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\n+DEFINE TABLE OVERWRITE script_migration SCHEMAFULL\r\n+    PERMISSIONS\r\n+        FOR select FULL\r\n+        FOR create, update, delete NONE;\r\n+\r\n+DEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\r\n DEFINE FIELD OVERWRITE executed_at ON script_migration TYPE datetime VALUE time::now() READONLY;\n-DEFINE TABLE OVERWRITE transaction TYPE NORMAL SCHEMAFULL PERMISSIONS NONE;\n+DEFINE TABLE OVERWRITE transaction TYPE NORMAL SCHEMAFULL PERMISSIONS NONE;\r\n+\r\n+DEFINE FIELD OVERWRITE amount ON transaction TYPE decimal PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE from ON transaction TYPE string PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE metadata ON transaction TYPE option<string> PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE timestamp ON transaction TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE to ON transaction TYPE string PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE transaction_type ON transaction TYPE 'unknown' | 'mined' | 'name_purchase' | 'transfer' PERMISSIONS FULL;\r\n+\r\n\n-DEFINE FIELD OVERWRITE amount ON transaction TYPE decimal PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE from ON transaction TYPE string PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE metadata ON transaction TYPE option<string> PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE timestamp ON transaction TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE to ON transaction TYPE string PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE transaction_type ON transaction TYPE 'unknown' | 'mined' | 'name_purchase' | 'transfer' PERMISSIONS FULL;\n-\n-\n-\n-DEFINE TABLE OVERWRITE wallet TYPE NORMAL SCHEMAFULL PERMISSIONS NONE;\n-\n-DEFINE FIELD OVERWRITE address ON wallet TYPE string PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE balance ON wallet TYPE decimal DEFAULT 0 PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE created_at ON wallet TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE hash ON wallet TYPE string PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE is_shared ON wallet TYPE bool DEFAULT false PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE total_in ON wallet TYPE decimal DEFAULT 0 PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE total_out ON wallet TYPE decimal DEFAULT 0 PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE locked ON wallet TYPE bool DEFAULT false PERMISSIONS FULL;\n-\n-DEFINE TABLE OVERWRITE owns TYPE RELATION IN player OUT wallet SCHEMAFULL PERMISSIONS NONE;\n-\n-DEFINE INDEX OVERWRITE addressIndex ON TABLE wallet COLUMNS address UNIQUE;\n-\n-UPDATE wallet SET address=\"name\", balance=0, created_at=time::now(), hash=\"some-hash-value\",is_shared=false, total_in=0, total_out=0, locked=false;\n\\ No newline at end of file\n+\r\n+DEFINE TABLE OVERWRITE wallet TYPE NORMAL SCHEMAFULL PERMISSIONS NONE;\r\n+\r\n+DEFINE FIELD OVERWRITE address ON wallet TYPE string PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE balance ON wallet TYPE decimal DEFAULT 0 PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE created_at ON wallet TYPE datetime DEFAULT time::now() PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE hash ON wallet TYPE string PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE is_shared ON wallet TYPE bool DEFAULT false PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE total_in ON wallet TYPE decimal DEFAULT 0 PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE total_out ON wallet TYPE decimal DEFAULT 0 PERMISSIONS FULL;\r\n+DEFINE FIELD OVERWRITE locked ON wallet TYPE bool DEFAULT false PERMISSIONS FULL;\r\n+\r\n+DEFINE TABLE OVERWRITE owns TYPE RELATION IN player OUT wallet SCHEMAFULL PERMISSIONS NONE;\r\n+\r\n+DEFINE INDEX OVERWRITE addressIndex ON TABLE wallet COLUMNS address UNIQUE;\n\\ No newline at end of file\n","events":"--- original\n+++ modified\n@@ -1,6 +1,6 @@\n-DEFINE EVENT OVERWRITE transfer_balance ON transaction WHEN $event = 'CREATE' THEN {\n-LET $from = $after.from;\n-LET $to = $after.to;\n-LET $amount = $after.amount;\n-RETURN fn::transfer_balance($from, $to, $amount);\n+DEFINE EVENT OVERWRITE transfer_balance ON transaction WHEN $event = 'CREATE' THEN {\r\n+LET $from = $after.from;\r\n+LET $to = $after.to;\r\n+LET $amount = $after.amount;\r\n+RETURN fn::transfer_balance($from, $to, $amount);\r\n };\n\\ No newline at end of file\n"}